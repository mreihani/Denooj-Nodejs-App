<!-- Content wrapper -->
<div class="content-wrapper">
    <!-- Content -->
    <div class="container-xxl flex-grow-1 container-p-y">
        <h4 class="py-3 mb-2">
            <span class="text-muted fw-light">فروشگاه /</span>
            <span class="text-muted fw-light">سفارشات /</span>
            جزئیات سفارش
        </h4>
        <form method="POST" action="/admin/order/update/<%= data.order._id %>?_method=PUT" >
            <input type="hidden" value="<%= csrfToken %>" name="_csrf">

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
                <div class="d-flex flex-column justify-content-center gap-2 gap-sm-0">
                    <h5 class="mb-1 mt-3 d-flex flex-wrap gap-2 align-items-end">
                        سفارش شماره:
                        <%= data.order.orderNumber %>

                        <% if (data.order.payment.status) { %>
                            <span class="badge bg-label-success">پرداخت شده</span>
                        <% } else { %>
                            <span class="badge bg-label-danger">پرداخت نشده</span>
                        <% } %>
                    </h5>
                    <div>
                        <p class="mb-0">
                            تاریخ ثبت سفارش:
                        </p>
                        <p class="text-body">
                            
                            <%= data.createdAtJalaliDate %>

                        </p>
                    </div>
                </div>
                <div class="d-flex align-content-center flex-wrap gap-2">
                    <a href="/admin/orders" class="btn btn-label-primary waves-effect">
                        <i class="ti ti-arrow-back me-sm-1"></i> 
                        بازگشت به لیست سفارشات
                    </a>
                    <button type="submit" class="text-white btn btn-primary waves-effect waves-light">
                        <i class="ti ti-device-floppy ti-xs me-1"></i>
                        ذخیره
                    </button>
                </div>
            </div>

            <!-- Order Details Table -->
            <div class="row">
                <div class="col-12 col-lg-8">
                    <div class="card invoice-preview-card">
                        <div class="card-body">
                            <div class="row p-sm-3 p-0">
                                <div class="col-md-6">
                                    <div class="d-flex justify-content-start align-items-center mb-4">
                                        <div class="avatar me-2">
                                            <img alt="آواتار" class="rounded-circle" src="<%= data.user.avatar !== null ? '/../../../profile/user-avatars/' + data.user.avatar : '/../../admin/assets/img/denooj/user.png' %>"/>
                                        </div>
                                        <div class="d-flex flex-column">
                                            <a class="text-body text-nowrap" href="">
                                                <h6 class="mb-0">
                                                    <%= (data.order.user.firstname) %>
                                                    <%= (data.order.user.lastname) %>
                                                </h6>
                                            </a>
                                            <small class="text-muted">شناسه مشتری: <%= (data.order.user._id) %></small>
                                        </div>
                                    </div>

                                    <% if (data.order.address != null) { %>
                                        <h6 class="mb-0 mt-3">
                                            آدرس:
                                        </h6>
                                        <p class="mb-2">
                                            <%= (data.order.address) %>
                                        </p>
                                    <% } %>

                                    <% if (data.order.postalCode != null) { %>
                                        <h6 class="mb-0 mt-3">
                                            کد پستی:
                                        </h6>
                                        <p class="mb-2">
                                            <%= (data.order.postalCode) %>
                                        </p>
                                    <% } %>

                                    <% if (data.order.user.phone != null) { %>
                                        <h6 class="mb-0 mt-3">
                                            شماره تماس:
                                        </h6>
                                        <p class="mb-1">
                                            <bdi>
                                                <a href="tel: <%= (data.order.user.phone) %>">
                                                    <%= (data.order.user.phone) %>
                                                </a>
                                            </bdi>
                                        </p>
                                    <% } %>

                                    <% if (data.order.user.emailAddress != null) { %>
                                        <h6 class="mb-0 mt-3">
                                            ایمیل:
                                        </h6>
                                        <p class="mb-0">
                                            <a href="mailto: <%= (data.order.user.emailAddress) %>">
                                                <%= (data.order.user.emailAddress) %>
                                            </a>
                                        </p>
                                    <% } %>

                                    <% if (JSON.parse(data.order.lotteryNumbers)) { %>
                                        <h6 class="mb-0 mt-3">
                                            شماره قرعه کشی اختصاص داده شده:
                                        </h6>
                                        <p class="mb-0">
                                            <% JSON.parse(data.order.lotteryNumbers).forEach(function(lotteryNumber, index) { %>
                                                <span class="badge bg-label-success">
                                                    <i class="ti ti-ticket ti-sm"></i>
                                                    <%= (lotteryNumber) %>
                                                </span>
                                            <% }); %> 
                                        </p>
                                    <% } %>
                                </div>
                                <div class="col-md-6">

                                    <% if (data.order.price != null) { %>
                                        <h6 class="mb-0">
                                            مبلغ سفارش:
                                        </h6>
                                        <bdi>
                                            <svg class="toman" width="1rem" height="1rem">
                                            <use xlink:href="#toman">
                                                <symbol id="toman" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
                                                    <path clip-rule="evenodd" d="M3.057 1.742L3.821 1l.78.75-.776.741-.768-.749zm3.23 2.48c0 .622-.16 1.111-.478 1.467-.201.221-.462.39-.783.505a3.251 3.251 0 01-1.083.163h-.555c-.421 0-.801-.074-1.139-.223a2.045 2.045 0 01-.9-.738A2.238 2.238 0 011 4.148c0-.059.001-.117.004-.176.03-.55.204-1.158.525-1.827l1.095.484c-.257.532-.397 1-.419 1.403-.002.04-.004.08-.004.12 0 .252.055.458.166.618a.887.887 0 00.5.354c.085.028.178.048.278.06.079.01.16.014.243.014h.555c.458 0 .769-.081.933-.244.14-.139.21-.383.21-.731V2.02h1.2v2.202zm5.433 3.184l-.72-.7.709-.706.735.707-.724.7zm-2.856.308c.542 0 .973.19 1.293.569.297.346.445.777.445 1.293v.364h.18v-.004h.41c.221 0 .377-.028.467-.084.093-.055.14-.14.14-.258v-.069c.004-.243.017-1.044 0-1.115L13 8.05v1.574a1.4 1.4 0 01-.287.863c-.306.405-.804.607-1.495.607h-.627c-.061.733-.434 1.257-1.117 1.573-.267.122-.58.21-.937.265a5.845 5.845 0 01-.914.067v-1.159c.612 0 1.072-.082 1.38-.247.25-.132.376-.298.376-.499h-.515c-.436 0-.807-.113-1.113-.339-.367-.273-.55-.667-.55-1.18 0-.488.122-.901.367-1.24.296-.415.728-.622 1.296-.622zm.533 2.226v-.364c0-.217-.048-.389-.143-.516a.464.464 0 00-.39-.187.478.478 0 00-.396.187.705.705 0 00-.136.449.65.65 0 00.003.067c.008.125.066.22.177.283.093.054.21.08.352.08h.533zM9.5 6.707l.72.7.724-.7L10.209 6l-.709.707zm-6.694 4.888h.03c.433-.01.745-.106.937-.29.024.012.065.035.12.068l.074.039.081.042c.135.073.261.133.379.18.345.146.67.22.977.22a1.216 1.216 0 00.87-.34c.3-.285.449-.714.449-1.286a2.19 2.19 0 00-.335-1.145c-.299-.457-.732-.685-1.3-.685-.502 0-.916.192-1.242.575-.113.132-.21.284-.294.456-.032.062-.06.125-.084.191a.504.504 0 00-.03.078 1.67 1.67 0 00-.022.06c-.103.309-.171.485-.205.53-.072.09-.214.14-.427.147-.123-.005-.209-.03-.256-.076-.057-.054-.085-.153-.085-.297V7l-1.201-.5v3.562c0 .261.048.496.143.703.071.158.168.296.29.413.123.118.266.211.43.28.198.084.42.13.665.136v.001h.036zm2.752-1.014a.778.778 0 00.044-.353.868.868 0 00-.165-.47c-.1-.134-.217-.201-.35-.201-.18 0-.33.103-.447.31-.042.071-.08.158-.114.262a2.434 2.434 0 00-.04.12l-.015.053-.015.046c.142.118.323.216.544.293.18.062.325.092.433.092.044 0 .086-.05.125-.152z" fill-rule="evenodd"></path>
                                                </symbol>
                                            </use>
                                            </svg>
                                            <%= (data.order.price) %>
                                        </bdi>
                                    <% } %>

                                    <% if (data.order.payment.tranceNo) { %>
                                        <h6 class="mb-0 mt-3">
                                            شماره رهگیری:
                                        </h6>
                                        <bdi>
                                            <%= (data.order.payment.tranceNo) %>
                                        </bdi>
                                    <% } %>

                                    <% if (data.order.payment.rrn) { %>
                                        <h6 class="mb-0 mt-3">
                                            RRN:
                                        </h6>
                                        <bdi>
                                            <%= data.order.payment.rrn %>
                                        </bdi>
                                    <% } %>

                                    <% if (data.order.payment.securePan) { %>
                                        <h6 class="mb-0 mt-3">
                                            شماره کارت:
                                        </h6>
                                        <bdi>
                                            <%= data.order.payment.securePan %>
                                        </bdi>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive border-top">
                            <table class="table m-0">
                                <thead>
                                    <tr>
                                        <th>ردیف</th>
                                        <th>محصول</th>
                                        <th>تعداد</th>
                                        <th>
                                            قیمت جزء
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>

                                <% data.order.products.forEach(function(productItem, index) { %>
                                    <tr>
                                        <td class="text-nowrap">
                                            <%= index + 1 %>
                                        </td>
                                        <td class="text-nowrap"> 
                                            <%= productItem.productTitle %>
                                        </td>
                                        <td>
                                            <%= productItem.qty %>
                                        </td>
                                        <td>
                                            <bdi>
                                                <svg class="toman" width="1rem" height="1rem">
                                                    <use xlink:href="#toman">
                                                        <symbol id="toman" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
                                                            <path clip-rule="evenodd" d="M3.057 1.742L3.821 1l.78.75-.776.741-.768-.749zm3.23 2.48c0 .622-.16 1.111-.478 1.467-.201.221-.462.39-.783.505a3.251 3.251 0 01-1.083.163h-.555c-.421 0-.801-.074-1.139-.223a2.045 2.045 0 01-.9-.738A2.238 2.238 0 011 4.148c0-.059.001-.117.004-.176.03-.55.204-1.158.525-1.827l1.095.484c-.257.532-.397 1-.419 1.403-.002.04-.004.08-.004.12 0 .252.055.458.166.618a.887.887 0 00.5.354c.085.028.178.048.278.06.079.01.16.014.243.014h.555c.458 0 .769-.081.933-.244.14-.139.21-.383.21-.731V2.02h1.2v2.202zm5.433 3.184l-.72-.7.709-.706.735.707-.724.7zm-2.856.308c.542 0 .973.19 1.293.569.297.346.445.777.445 1.293v.364h.18v-.004h.41c.221 0 .377-.028.467-.084.093-.055.14-.14.14-.258v-.069c.004-.243.017-1.044 0-1.115L13 8.05v1.574a1.4 1.4 0 01-.287.863c-.306.405-.804.607-1.495.607h-.627c-.061.733-.434 1.257-1.117 1.573-.267.122-.58.21-.937.265a5.845 5.845 0 01-.914.067v-1.159c.612 0 1.072-.082 1.38-.247.25-.132.376-.298.376-.499h-.515c-.436 0-.807-.113-1.113-.339-.367-.273-.55-.667-.55-1.18 0-.488.122-.901.367-1.24.296-.415.728-.622 1.296-.622zm.533 2.226v-.364c0-.217-.048-.389-.143-.516a.464.464 0 00-.39-.187.478.478 0 00-.396.187.705.705 0 00-.136.449.65.65 0 00.003.067c.008.125.066.22.177.283.093.054.21.08.352.08h.533zM9.5 6.707l.72.7.724-.7L10.209 6l-.709.707zm-6.694 4.888h.03c.433-.01.745-.106.937-.29.024.012.065.035.12.068l.074.039.081.042c.135.073.261.133.379.18.345.146.67.22.977.22a1.216 1.216 0 00.87-.34c.3-.285.449-.714.449-1.286a2.19 2.19 0 00-.335-1.145c-.299-.457-.732-.685-1.3-.685-.502 0-.916.192-1.242.575-.113.132-.21.284-.294.456-.032.062-.06.125-.084.191a.504.504 0 00-.03.078 1.67 1.67 0 00-.022.06c-.103.309-.171.485-.205.53-.072.09-.214.14-.427.147-.123-.005-.209-.03-.256-.076-.057-.054-.085-.153-.085-.297V7l-1.201-.5v3.562c0 .261.048.496.143.703.071.158.168.296.29.413.123.118.266.211.43.28.198.084.42.13.665.136v.001h.036zm2.752-1.014a.778.778 0 00.044-.353.868.868 0 00-.165-.47c-.1-.134-.217-.201-.35-.201-.18 0-.33.103-.447.31-.042.071-.08.158-.114.262a2.434 2.434 0 00-.04.12l-.015.053-.015.046c.142.118.323.216.544.293.18.062.325.092.433.092.044 0 .086-.05.125-.152z" fill-rule="evenodd"></path>
                                                        </symbol>
                                                    </use>
                                                </svg>
                                                <%= productItem.price %>
                                            </bdi>
                                        </td>
                                    </tr>
                                <% }); %> 
                                
                                <tr>
                                    <td class="align-top px-4 py-4" colspan="2">
                                        <p class="mb-2 mt-3">
                                            <span class="ms-3 fw-medium">

                                            </span>
                                            <span>
                                                
                                            </span>
                                        </p>
                                        <span class="ms-3">
                                            
                                        </span>
                                    </td>
                                    <td class="text-end pe-3 py-4">
                                        <p class="mb-0 pb-3">جمع کل:</p>
                                    </td>
                                    <td class="ps-2 py-4">
                                        <p class="fw-medium mb-0 pb-3">
                                            <bdi>
                                                <svg class="toman" width="1rem" height="1rem">
                                                    <use xlink:href="#toman">
                                                        <symbol id="toman" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
                                                            <path clip-rule="evenodd" d="M3.057 1.742L3.821 1l.78.75-.776.741-.768-.749zm3.23 2.48c0 .622-.16 1.111-.478 1.467-.201.221-.462.39-.783.505a3.251 3.251 0 01-1.083.163h-.555c-.421 0-.801-.074-1.139-.223a2.045 2.045 0 01-.9-.738A2.238 2.238 0 011 4.148c0-.059.001-.117.004-.176.03-.55.204-1.158.525-1.827l1.095.484c-.257.532-.397 1-.419 1.403-.002.04-.004.08-.004.12 0 .252.055.458.166.618a.887.887 0 00.5.354c.085.028.178.048.278.06.079.01.16.014.243.014h.555c.458 0 .769-.081.933-.244.14-.139.21-.383.21-.731V2.02h1.2v2.202zm5.433 3.184l-.72-.7.709-.706.735.707-.724.7zm-2.856.308c.542 0 .973.19 1.293.569.297.346.445.777.445 1.293v.364h.18v-.004h.41c.221 0 .377-.028.467-.084.093-.055.14-.14.14-.258v-.069c.004-.243.017-1.044 0-1.115L13 8.05v1.574a1.4 1.4 0 01-.287.863c-.306.405-.804.607-1.495.607h-.627c-.061.733-.434 1.257-1.117 1.573-.267.122-.58.21-.937.265a5.845 5.845 0 01-.914.067v-1.159c.612 0 1.072-.082 1.38-.247.25-.132.376-.298.376-.499h-.515c-.436 0-.807-.113-1.113-.339-.367-.273-.55-.667-.55-1.18 0-.488.122-.901.367-1.24.296-.415.728-.622 1.296-.622zm.533 2.226v-.364c0-.217-.048-.389-.143-.516a.464.464 0 00-.39-.187.478.478 0 00-.396.187.705.705 0 00-.136.449.65.65 0 00.003.067c.008.125.066.22.177.283.093.054.21.08.352.08h.533zM9.5 6.707l.72.7.724-.7L10.209 6l-.709.707zm-6.694 4.888h.03c.433-.01.745-.106.937-.29.024.012.065.035.12.068l.074.039.081.042c.135.073.261.133.379.18.345.146.67.22.977.22a1.216 1.216 0 00.87-.34c.3-.285.449-.714.449-1.286a2.19 2.19 0 00-.335-1.145c-.299-.457-.732-.685-1.3-.685-.502 0-.916.192-1.242.575-.113.132-.21.284-.294.456-.032.062-.06.125-.084.191a.504.504 0 00-.03.078 1.67 1.67 0 00-.022.06c-.103.309-.171.485-.205.53-.072.09-.214.14-.427.147-.123-.005-.209-.03-.256-.076-.057-.054-.085-.153-.085-.297V7l-1.201-.5v3.562c0 .261.048.496.143.703.071.158.168.296.29.413.123.118.266.211.43.28.198.084.42.13.665.136v.001h.036zm2.752-1.014a.778.778 0 00.044-.353.868.868 0 00-.165-.47c-.1-.134-.217-.201-.35-.201-.18 0-.33.103-.447.31-.042.071-.08.158-.114.262a2.434 2.434 0 00-.04.12l-.015.053-.015.046c.142.118.323.216.544.293.18.062.325.092.433.092.044 0 .086-.05.125-.152z" fill-rule="evenodd"></path>
                                                        </symbol>
                                                    </use>
                                                </svg>
                                                <%= (data.order.price) %>
                                            </bdi>
                                        </p>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <% if (data.order.orderNote != null) { %>
                            <div class="card-body mx-3">
                                <div class="row">
                                    <div class="col-12">
                                        <span class="fw-medium">توضیحات خریدار:</span>
                                        <span>  
                                            <%= (data.order.orderNote) %>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                        
                    </div>
                </div>

                <div class="col-12 col-lg-4">
                    <!-- Order Status -->
                    <div class="card card-action mb-4">
                        <div class="card-header align-items-center">
                            <h5 class="card-action-title mb-0">
                                وضعیت سفارش
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3 col ecommerce-select2-dropdown">
                                <label class="form-label mb-1" for="status-org">وضعیت</label>
                                <select class="select2 form-select" data-placeholder="وضعیت سفارش" id="status-org" name="status">
                                    <option value="preparation" <%= (data.order.status == 'preparation' ? 'selected' : '') %> >
                                        در حال پردازش
                                    </option>
                                    <option value="posted" <%= (data.order.status == 'posted' ? 'selected' : '') %> >
                                        تحویل شده
                                    </option>
                                    <option value="cancelled" <%= (data.order.status == 'cancelled' ? 'selected' : '') %> >
                                        لغو شده
                                    </option>
                                    <option value="returned" <%= (data.order.status == 'returned' ? 'selected' : '') %> >
                                        مرجوع شده
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- ./Order Status -->

                    <!-- Shipping Post serial number -->
                    <div class="card card-action mb-4">
                        <div class="card-header align-items-center">
                            <h5 class="card-action-title mb-0">
                                کد رهگیری مرسوله
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label" for="post-serial-number">
                                    می توانید پس از ارسال کالا از طریق پست، کد رهگیری پستی آن را از طریق این فرم به کاربر اطلاع دهید
                                </label>
                                <input 
                                    aria-label="قیمت محصول" 
                                    class="form-control" 
                                    id="post-serial-number" 
                                    name="trackingSerial" 
                                    placeholder="کد رهگیری" 
                                    type="text"
                                    value="<%= (data.order.trackingSerial !== null ? data.order.trackingSerial : '') %>"
                                >
                            </div>
                        </div>
                    </div>
                    <!-- ./Shipping Post serial number -->
                </div>
            </div>
        </form>
    </div>
    <!-- / Content -->
    <div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->


